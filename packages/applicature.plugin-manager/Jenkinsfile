properties properties: [
    [$class: 'BuildDiscarderProperty', strategy: [$class: 'LogRotator', artifactDaysToKeepStr: '', artifactNumToKeepStr: '', numToKeepStr: '10']],
]

node {
    def buildNumber = env.BUILD_NUMBER
    def workspace = env.WORKSPACE
    def buildUrl = env.BUILD_URL

    // PRINT ENVIRONMENT TO JOB
    echo "workspace directory is $workspace"
    echo "build URL is $buildUrl"
    echo "build Number is $buildNumber"

    nodejs(configId: '661cf31b-bdac-4946-bf6d-251593378980', nodeJSInstallationName: 'Node 8.x') {
        sh 'node -- version'
        sh 'npm --version'

        try {
            stage('Checkout') {
              checkout scm
            }

            stage('Build') {
              sh "npm install"
              sh "npm run build"
            }

            /*
            stage('Test') {
              sh "npm run test && npm run e2e"
              junit 'target/test-reports/TEST*.xml'
            }
            */

            stage('Publish NPM snapshot') {
              def currentVersion = sh(returnStdout: true, script: "npm version | grep \"{\" | tr -s ':'  | cut -d \"'\" -f 4").trim()
              def newVersion = "${currentVersion}-${buildNumber}"
              sh "npm version ${newVersion} --no-git-tag-version && npm publish --tag next"
            }

        } catch (e) {
            // rocketSend channel: 'jenkins', message: 'Fehler'
            throw e
        }
    }
}